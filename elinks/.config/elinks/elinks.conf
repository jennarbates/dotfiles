# -----------------------------------------------------------------
# --- 1. AGGRESSIVE UNBIND: CLEAR ALL DEFAULT CONFLICTS (VIM KEYS) ---
# -----------------------------------------------------------------

# The full cleanup ensures 'k' is unbound from the high-priority Menu and Global maps.
# This prevents the Keybinding Manager from opening.

unbind "Global mapping" "j"
unbind "Global mapping" "k"
unbind "Global mapping" "h"
unbind "Global mapping" "l"

unbind "Menu mapping" "j"
unbind "Menu mapping" "k" 
unbind "Menu mapping" "h"
unbind "Menu mapping" "l"

unbind "Main mapping" "j"
unbind "Main mapping" "k"
unbind "Main mapping" "h"
unbind "Main mapping" "l"

unbind "Link mapping" "j"
unbind "Link mapping" "k"
unbind "Link mapping" "h"
unbind "Link mapping" "l"

unbind "Form mapping" "j"
unbind "Form mapping" "k"
unbind "Form mapping" "h"
unbind "Form mapping" "l"

# -----------------------------------------------------------------
# --- 2. CUSTOM VIM BINDINGS: SINGLE DECLARATION ---
# -----------------------------------------------------------------

# SCROLLING/PAGING (Use next-page/prev-page for reliable full-screen movement)
bind "Main mapping" "j" = "next-page"
bind "Main mapping" "k" = "prev-page"

# HISTORY/LINK ACTIONS
bind "Main mapping" "h" = "go-back"
bind "Main mapping" "l" = "follow-current-link"

# TOP/BOTTOM
bind "Main mapping" "G" = "scroll-to-end"
bind "Main mapping" "gg" = "scroll-to-start"

# LINK NAVIGATION (When cursor is on a link, j/k moves to the next/previous link)
bind "Link mapping" "j" = "next-link"
bind "Link mapping" "k" = "prev-link"

# MENU
bind "Main mapping" ":" = "main-menu"

# Move the problematic Keybinding Manager action from 'k' to 'K'
bind "Global mapping" "K" = "keybinding-manager"

# -----------------------------------------------------------------
# --- 3. COLOR SCHEME CUSTOMIZATION (Gruvbox Dark Template) ---
# -----------------------------------------------------------------

# Background and Default Text
set document.color.background = "black"
set document.color.normal = "brwhite"

# Links (How they appear on the page)
set document.color.link = "brblue"
set document.color.vlink = "brmagenta"
set document.color.link_in_form = "green"

# UI Elements (Menus, status bar, scrollbar, etc.)
set ui.color_terminals.menu_bg = "black"
set ui.color_terminals.menu_fg = "brwhite"
set ui.color_terminals.status_bar_bg = "brblack"  # Muted Dark Gray
set ui.color_terminals.status_bar_fg = "brwhite"

# Highlighted items (The active link/menu item)
set ui.color_terminals.active_highlight_bg = "yellow"
set ui.color_terminals.active_highlight_fg = "black"

# Frames and Info Boxes
set ui.color_terminals.dialog_box_bg = "black"
set ui.color_terminals.dialog_box_fg = "brwhite"
set ui.color_terminals.dialog_box_text_bg = "black"
set ui.color_terminals.dialog_box_text_fg = "brgreen"

# Scrollbar
set ui.color_terminals.scrollbar_bg = "brblack"
set ui.color_terminals.scrollbar_fg = "brwhite"

# -----------------------------------------------------------------
# --- 4. DEFAULT ELinks Options (Non-Essential but clean) ---
# -----------------------------------------------------------------

# These settings are often added when ELinks saves the file, keeping them clean prevents errors.
set config.saving_style_w = 1
set ui.language = "System"

# Explicitly enable ECMAScript (JavaScript) support
set document.ecmascript = 1

# Stop ELinks from asking for confirmation when running JavaScript
set document.ecmascript.confirm = 0

# Ensure ELinks processes embedded scripts
set document.ecmascript.enable_scripts = 1

# --- EXTERNAL VIEWER SETUP (Workaround for JavaScript) ---

# 1. Enable URI passing (required to send URL to an external application)
set document.uri_passing = 1

# 2. Define the command to launch the browser (the macOS 'open' command)
# 'open' will use Safari as the default handler for web URLs if Chrome/Firefox aren't set as default.
# If you want to explicitly force Safari, the command is 'open -a Safari'.
set document.uri_passing.external_viewer = "open -a Safari"

# 3. Define the command-line arguments to launch a URL with the external viewer.
# %u is the variable for the current URL.
set document.uri_passing.external_viewer_argument = "%u"
